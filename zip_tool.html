<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–õ–æ–∫–∞–ª—å–Ω—ã–π ZIP –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg:#f6f7fb;--panel:#fff;--panel-soft:#fafafa;--text:#0f172a;--muted:#6b7280;
      --border:#e5e7eb;--accent:#2563eb;--accent-soft:rgba(37,99,235,.08);
    }
    [data-theme="dark"]{
      --bg:#0b1020;--panel:#0f172a;--panel-soft:#111827;--text:#e5e7eb;--muted:#9ca3af;
      --border:#1f2937;--accent:#60a5fa;--accent-soft:rgba(96,165,250,.12);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text)}

    .app{max-width:1200px;margin:0 auto;padding:28px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    header h1{font-size:20px;font-weight:700;letter-spacing:-.02em}

    .theme-toggle{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:6px 10px;cursor:pointer;font-size:18px}

    .tabs{display:flex;gap:6px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:6px;width:fit-content;margin-bottom:24px}
    .tab{padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:500;color:var(--muted)}
    .tab.active{background:var(--accent-soft);color:var(--accent)}

    .panel{display:none;grid-template-columns:1.2fr .8fr;gap:24px}
    .panel.active{display:grid}

    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:20px}
    .card h3{margin:0 0 12px;font-size:14px;font-weight:600}

    .dropzone{border:2px dashed var(--border);border-radius:14px;padding:32px;text-align:center;background:var(--panel-soft)}
    .dropzone.drag{border-color:var(--accent);background:var(--accent-soft)}
    input[type=file]{display:none}

    .actions{display:flex;gap:10px;justify-content:center;margin-top:14px}
    button,.btn{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:500;cursor:pointer}
    button.secondary,.btn.secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}
    button:disabled{opacity:.5;cursor:not-allowed}

    .progress{margin-top:14px}
    .progress-bar{height:6px;background:var(--border);border-radius:999px;overflow:hidden}
    .progress-bar span{display:block;height:100%;width:0;background:var(--accent);transition:width .2s}
    .progress-label{margin-top:6px;font-size:12px;color:var(--muted);text-align:right}

    .tree{font-size:13px;line-height:1.6;user-select:none}
    .tree-item{display:flex;align-items:center;gap:6px;padding:2px 0;cursor:default}
    .tree-item:hover{background:var(--accent-soft)}
    .tree-folder{font-weight:600;cursor:pointer}
    .tree-indent{margin-left:18px}

    .context{position:fixed;background:var(--panel);border:1px solid var(--border);border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.15);z-index:1000;display:none}
    .context button{display:block;width:100%;padding:8px 14px;background:none;border:none;text-align:left;color:var(--text);cursor:pointer}
    .context button:hover{background:var(--accent-soft)}

    footer{margin-top:40px;text-align:center;font-size:12px;color:var(--muted)}
    @media(max-width:900px){.panel.active{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>–õ–æ–∫–∞–ª—å–Ω—ã–π ZIP –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä</h1>
    <button class="theme-toggle" id="themeToggle">üåô</button>
  </header>

  <div class="tabs">
    <div class="tab active" data-tab="create">–°–æ–∑–¥–∞—Ç—å</div>
    <div class="tab" data-tab="extract">–ò–∑–≤–ª–µ—á—å</div>
  </div>

  <section class="panel active" id="create">
    <div class="card">
      <h3>–§–∞–π–ª—ã</h3>
      <div class="dropzone" id="createDrop">
        <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏</strong>
        <div class="actions">
          <label class="btn secondary">–§–∞–π–ª—ã<input type="file" multiple id="filePick"></label>
          <label class="btn secondary">–ü–∞–ø–∫–∞<input type="file" webkitdirectory id="folderPick"></label>
        </div>
      </div>
      <div class="tree" id="fileTree"></div>
    </div>
    <div class="card">
      <h3>–≠–∫—Å–ø–æ—Ä—Ç</h3>
      <input id="zipName" value="archive.zip" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text)">
      <div class="progress" id="createProgress" hidden>
        <div class="progress-bar"><span></span></div>
        <div class="progress-label"></div>
      </div>
      <button id="buildZip" disabled style="margin-top:14px">–°–æ–∑–¥–∞—Ç—å ZIP</button>
    </div>
  </section>

  <section class="panel" id="extract">
    <div class="card">
      <h3>–ê—Ä—Ö–∏–≤</h3>
      <div class="dropzone" id="extractDrop">
        <strong>ZIP —Ñ–∞–π–ª</strong>
        <div class="actions">
          <label class="btn secondary">–í—ã–±—Ä–∞—Ç—å<input type="file" accept=".zip" id="zipPick"></label>
        </div>
      </div>
      <div class="tree" id="zipTree"></div>
    </div>
    <div class="card">
      <h3>–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ</h3>
      <div class="progress" id="extractProgress" hidden>
        <div class="progress-bar"><span></span></div>
        <div class="progress-label"></div>
      </div>
      <button id="downloadAll" disabled>–°–∫–∞—á–∞—Ç—å –≤—Å—ë</button>
    </div>
  </section>

  <footer>–õ–æ–∫–∞–ª—å–Ω—ã–π ZIP –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä. –§–∞–π–ª—ã –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç –±—Ä–∞—É–∑–µ—Ä</footer>
</div>

<div class="context" id="contextMenu">
  <button id="ctxDownload">–°–∫–∞—á–∞—Ç—å</button>
  <button id="ctxDelete">–£–¥–∞–ª–∏—Ç—å</button>
</div>

<script>
const root=document.documentElement;const btnTheme=document.getElementById('themeToggle');
root.dataset.theme=localStorage.getItem('zip-theme')||'light';
btnTheme.textContent=root.dataset.theme==='dark'?'‚òÄÔ∏è':'üåô';
btnTheme.onclick=()=>{root.dataset.theme=root.dataset.theme==='dark'?'light':'dark';localStorage.setItem('zip-theme',root.dataset.theme);btnTheme.textContent=root.dataset.theme==='dark'?'‚òÄÔ∏è':'üåô'};
document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>{document.querySelectorAll('.tab,.panel').forEach(e=>e.classList.remove('active'));t.classList.add('active');document.getElementById(t.dataset.tab).classList.add('active')});
function updateProgress(w,p,l){w.hidden=false;w.querySelector('span').style.width=p+'%';w.querySelector('.progress-label').textContent=l;if(p>=100)setTimeout(()=>w.hidden=true,800)}
function buildTree(container, tree, level=0){for(const [name,node] of Object.entries(tree)){const row=document.createElement('div');row.className='tree-item'+(level?' tree-indent':'');if(node._file){row.textContent='üìÑ '+name;row.dataset.path=node._file.name;row.dataset.type='file'}else{row.innerHTML='<span class="tree-folder">üìÅ '+name+'</span>';row.dataset.type='folder';row.onclick=()=>child.hidden=!child.hidden}
container.appendChild(row);if(!node._file){const child=document.createElement('div');child.hidden=false;container.appendChild(child);buildTree(child,node,level+1)}}}
const files=new Map();const fileTree=document.getElementById('fileTree');const buildBtn=document.getElementById('buildZip');const createProgress=document.getElementById('createProgress');
function rebuildCreateTree(){const t={};files.forEach((f,p)=>{p.split('/').reduce((a,c,i,arr)=>a[c]||(a[c]=i===arr.length-1?{_file:f}:{}) ,t)});fileTree.innerHTML='';buildTree(fileTree,t);buildBtn.disabled=!files.size}
function addFiles(list){[...list].forEach(f=>files.set(f.webkitRelativePath||f.name,f));rebuildCreateTree()}
document.getElementById('filePick').onchange=e=>addFiles(e.target.files);document.getElementById('folderPick').onchange=e=>addFiles(e.target.files);
buildBtn.onclick=async()=>{const zip=new JSZip();files.forEach((f,p)=>zip.file(p,f));const blob=await zip.generateAsync({type:'blob'},m=>updateProgress(createProgress,m.percent|0,'–°–∂–∞—Ç–∏–µ '+(m.percent|0)+'%'));saveAs(blob,document.getElementById('zipName').value||'archive.zip')};
let loadedZip;const zipTree=document.getElementById('zipTree');const extractProgress=document.getElementById('extractProgress');const downloadAll=document.getElementById('downloadAll');
document.getElementById('zipPick').onchange=async e=>{loadedZip=await JSZip.loadAsync(e.target.files[0],m=>updateProgress(extractProgress,m.percent|0,'–ß—Ç–µ–Ω–∏–µ '+(m.percent|0)+'%'));const t={};Object.values(loadedZip.files).forEach(f=>!f.dir&&f.name.split('/').reduce((a,c,i,arr)=>a[c]||(a[c]=i===arr.length-1?{_file:f}:{}) ,t));zipTree.innerHTML='';buildTree(zipTree,t);downloadAll.disabled=false};
downloadAll.onclick=async()=>{const z=new JSZip();for(const f of Object.values(loadedZip.files))if(!f.dir)z.file(f.name,await f.async('blob'));saveAs(await z.generateAsync({type:'blob'}),'extracted.zip')};
const ctx=document.getElementById('contextMenu');let ctxTarget=null;
document.addEventListener('contextmenu',e=>{const item=e.target.closest('.tree-item');if(!item||item.dataset.type!=='file')return; e.preventDefault();ctxTarget=item;ctx.style.left=e.pageX+'px';ctx.style.top=e.pageY+'px';ctx.style.display='block'});
document.addEventListener('click',()=>ctx.style.display='none');
document.getElementById('ctxDownload').onclick=async()=>{const p=ctxTarget.dataset.path;const f=loadedZip?loadedZip.file(p):files.get(p);if(f){const blob=loadedZip?await f.async('blob'):f;saveAs(blob,p.split('/').pop())}};
document.getElementById('ctxDelete').onclick=()=>{if(!loadedZip&&ctxTarget){files.delete(ctxTarget.dataset.path);rebuildCreateTree()}};
function dnd(z,cb){['dragover','dragenter'].forEach(e=>z.addEventListener(e,ev=>{ev.preventDefault();z.classList.add('drag')}));['dragleave','drop'].forEach(e=>z.addEventListener(e,ev=>{ev.preventDefault();z.classList.remove('drag')}));z.addEventListener('drop',e=>cb(e.dataTransfer.files))}
dnd(document.getElementById('createDrop'),addFiles);
dnd(document.getElementById('extractDrop'),f=>document.getElementById('zipPick').files=f);
</script>
</body>
</html>
